(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define("@adobe/aem-core-cif-product-recs-extension", [], factory);
	else if(typeof exports === 'object')
		exports["@adobe/aem-core-cif-product-recs-extension"] = factory();
	else
		root["@adobe/aem-core-cif-product-recs-extension"] = factory();
})(window, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/dist/";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 8);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

module.exports = require("react");

/***/ }),
/* 1 */
/***/ (function(module, exports) {

module.exports = require("prop-types");

/***/ }),
/* 2 */
/***/ (function(module, exports) {

module.exports = require("@adobe/aem-core-cif-react-components");

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin
module.exports = {"card":"cmp-ProductRecsGallery__ProductCard__card","cardImage":"cmp-ProductRecsGallery__ProductCard__cardImage","productImage":"cmp-ProductRecsGallery__ProductCard__productImage","addToCart":"cmp-ProductRecsGallery__ProductCard__addToCart","addToWishlist":"cmp-ProductRecsGallery__ProductCard__addToWishlist","price":"cmp-ProductRecsGallery__ProductCard__price","regularPrice":"cmp-ProductRecsGallery__ProductCard__regularPrice","discountedPrice":"cmp-ProductRecsGallery__ProductCard__discountedPrice"};

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin
module.exports = {"root":"cmp-ProductRecsGallery__ProductRecsGallery__root","container":"cmp-ProductRecsGallery__ProductRecsGallery__container","title":"cmp-ProductRecsGallery__ProductRecsGallery__title"};

/***/ }),
/* 5 */
/***/ (function(module, exports) {

module.exports = require("@apollo/client");

/***/ }),
/* 6 */
/***/ (function(module, exports) {

module.exports = require("@magento/recommendations-js-sdk");

/***/ }),
/* 7 */
/***/ (function(module, exports) {

module.exports = require("react-intl");

/***/ }),
/* 8 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, "ProductRecsGallery", function() { return /* reexport */ components_ProductRecsGallery_ProductRecsGallery; });
__webpack_require__.d(__webpack_exports__, "StorefrontInstanceContextProvider", function() { return /* reexport */ StorefrontInstanceContextProvider; });
__webpack_require__.d(__webpack_exports__, "useStorefrontInstanceContext", function() { return /* reexport */ useStorefrontInstanceContext; });
__webpack_require__.d(__webpack_exports__, "useRecommendations", function() { return /* reexport */ useRecommendations; });
__webpack_require__.d(__webpack_exports__, "useVisibilityObserver", function() { return /* reexport */ useVisibilityObserver; });

// EXTERNAL MODULE: external "react"
var external_react_ = __webpack_require__(0);
var external_react_default = /*#__PURE__*/__webpack_require__.n(external_react_);

// EXTERNAL MODULE: external "prop-types"
var external_prop_types_ = __webpack_require__(1);
var external_prop_types_default = /*#__PURE__*/__webpack_require__.n(external_prop_types_);

// EXTERNAL MODULE: external "@adobe/aem-core-cif-react-components"
var aem_core_cif_react_components_ = __webpack_require__(2);

// EXTERNAL MODULE: external "@apollo/client"
var client_ = __webpack_require__(5);

// CONCATENATED MODULE: ./src/queries/query_storefront_instance_context.graphql.js
/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ~ Copyright 2021 Adobe
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~
 ~     http://www.apache.org/licenses/LICENSE-2.0
 ~
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/

/* harmony default export */ var query_storefront_instance_context_graphql = (client_["gql"]`
    query DataServicesStorefrontInstanceContext {
        dataServicesStorefrontInstanceContext {
            catalog_extension_version
            environment
            environment_id
            store_code
            store_id
            store_name
            store_url
            store_view_code
            store_view_id
            store_view_name
            website_code
            website_id
            website_name
        }
        storeConfig {
            base_currency_code
            store_code
        }
    }
`);
// CONCATENATED MODULE: ./src/context/StorefrontInstanceContext.js
/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ~ Copyright 2021 Adobe
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~
 ~     http://www.apache.org/licenses/LICENSE-2.0
 ~
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/




const STORAGE_KEY = 'CIF_STOREFRONT_INSTANCE_CONTEXT';
const StorefrontInstanceContext = /*#__PURE__*/external_react_default.a.createContext();
const StorefrontInstanceContextProvider = (props = {}) => {
  const getStorefrontInstanceContext = Object(aem_core_cif_react_components_["useAwaitQuery"])(query_storefront_instance_context_graphql);
  const [storefrontContext, setStorefrontContext] = Object(external_react_["useState"])({
    context: null,
    error: null,
    mse: undefined
  }); // eslint-disable-next-line react-hooks/rules-of-hooks

  const mse = typeof props.mse !== 'undefined' ? props.mse : Object(aem_core_cif_react_components_["useStorefrontEvents"])();
  Object(external_react_["useEffect"])(() => {
    (async () => {
      // Try to read storefront context from session storage
      let data = sessionStorage.getItem(STORAGE_KEY);

      if (data !== null) {
        try {
          data = JSON.parse(data);
        } catch (err) {
          console.warn('Could not parse storefront instance context from session storage', err);
          sessionStorage.removeItem(STORAGE_KEY);
          data = null;
        }
      } // Get storefront context from GraphQL if not available in session storage


      if (data === null) {
        let error;
        let storefrontInstanceContext;

        try {
          // We need a try/catch here, since Magento might return an invalid GraphQL response when sending
          // a product recs query to an instance that does not have product recs extensions installed.
          storefrontInstanceContext = await getStorefrontInstanceContext();
          error = storefrontInstanceContext.error;
        } catch (err) {
          error = err;
        }

        if (error) {
          console.error('Could not fetch storefront instance context', error);
          setStorefrontContext({
            context: null,
            error
          });
          return;
        }

        data = storefrontInstanceContext.data;
        sessionStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }

      const {
        environment,
        environment_id,
        website_id,
        website_code,
        website_name,
        store_url,
        store_id,
        store_code,
        store_name,
        store_view_id,
        store_view_code,
        store_view_name,
        catalog_extension_version
      } = data.dataServicesStorefrontInstanceContext;
      const {
        base_currency_code
      } = data.storeConfig;
      const context = {
        environmentId: environment_id,
        environment,
        storeUrl: store_url,
        websiteId: website_id,
        websiteCode: website_code,
        storeId: store_id,
        storeCode: store_code,
        storeViewId: store_view_id,
        storeViewCode: store_view_code,
        websiteName: website_name,
        storeName: store_name,
        storeViewName: store_view_name,
        baseCurrencyCode: base_currency_code,
        storeViewCurrencyCode: base_currency_code,
        catalogExtensionVersion: catalog_extension_version
      }; // Store storefront context in mse

      mse && mse.context.setStorefrontInstance(context);
      setStorefrontContext({
        context,
        error: null,
        mse
      });
    })();
  }, [mse]);
  return /*#__PURE__*/external_react_default.a.createElement(StorefrontInstanceContext.Provider, {
    value: storefrontContext
  }, props.children);
};
StorefrontInstanceContextProvider.propTypes = {
  mse: external_prop_types_default.a.object
};
const useStorefrontInstanceContext = () => Object(external_react_["useContext"])(StorefrontInstanceContext);
// EXTERNAL MODULE: external "@magento/recommendations-js-sdk"
var recommendations_js_sdk_ = __webpack_require__(6);
var recommendations_js_sdk_default = /*#__PURE__*/__webpack_require__.n(recommendations_js_sdk_);

// CONCATENATED MODULE: ./src/hooks/useRecommendations.js
/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ~ Copyright 2021 Adobe
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~
 ~     http://www.apache.org/licenses/LICENSE-2.0
 ~
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/





const commaToOrList = list => list.split(',').join(' OR ');

const useRecommendations = props => {
  const {
    context: storefrontInstance,
    error: storefrontInstanceError,
    mse
  } = useStorefrontInstanceContext();
  const [data, setData] = Object(external_react_["useState"])({
    loading: true,
    units: null
  });
  const pageType = Object(aem_core_cif_react_components_["usePageType"])();
  const {
    title,
    recommendationType,
    categoryExclusions,
    categoryInclusions,
    excludeMaxPrice,
    excludeMinPrice,
    includeMaxPrice,
    includeMinPrice,
    preconfigured = false
  } = props;

  const getFilters = () => {
    let result = []; // This is currently limited to a single filter by the recommendations SDK

    if (categoryInclusions) {
      result.push(`categories: (${commaToOrList(categoryInclusions)})`);
    }

    if (categoryExclusions) {
      result.push(`-categories: (${commaToOrList(categoryExclusions)})`);
    }

    if (includeMinPrice) {
      result.push(`prices.minimum.final: >${includeMinPrice}`);
    }

    if (includeMaxPrice) {
      result.push(`prices.maximum.final: <${includeMaxPrice}`);
    }

    if (excludeMinPrice) {
      result.push(`prices.maximum.final: <${excludeMinPrice}`);
    }

    if (excludeMaxPrice) {
      result.push(`prices.minimum.final: >${excludeMaxPrice}`);
    }

    return result;
  };

  const translateFilters = (filters, storeViewCode) => {
    // Translate all filters, except for the first one. The first one is translated by the Recommendations SDK.
    if (filters.length < 2) {
      return filters;
    }

    for (let i = 1; i < filters.length; i++) {
      const split = filters[i].split(':');
      split[0] = split[0].replace('categories', `product.${storeViewCode}.categories`).replace('prices', `product.${storeViewCode}.prices`);
      filters[i] = split.join(':');
    }

    return filters;
  };

  Object(external_react_["useEffect"])(() => {
    // Stop loading if there is an error while retrieving the storefront instance context
    if (storefrontInstanceError) {
      setData({
        loading: false,
        units: null
      });
      return;
    } // Skip if storefront instance context is not yet available


    if (!storefrontInstance) {
      return;
    }

    (async () => {
      // If no parameters are passed, everything is automatically taken from MSE
      const client = new recommendations_js_sdk_default.a({
        alternateEnvironmentId: '',
        pageType
      });

      if (!preconfigured) {
        // Get all configured filters, translate them, except for the first one and concatenate them with AND.
        // This is considered a workaround and should be fixed in the Recommendations SDK.
        let filters = getFilters();
        filters = translateFilters(filters, client._storeViewCode);
        filters = filters.join(' AND '); // Register recommendation as configured in component dialog

        client.register({
          name: title,
          type: recommendationType,
          filter: filters
        });
      }

      mse && mse.publish.recsRequestSent();
      const {
        status,
        data
      } = await (preconfigured ? client.fetchPreconfigured() : client.fetch());

      if (status !== 200 || !data || (!data.units || data.units.length === 0) && (!data.results || data.results.length === 0)) {
        setData({
          loading: false,
          units: null
        });
        return;
      } // Fix inconsistency in result API


      const newUnits = preconfigured ? data.results : data.units;

      if (mse) {
        const {
          units = []
        } = mse.context.getRecommendations() || {};
        mse.context.setRecommendations({
          units: [...units, ...newUnits]
        });
        mse.publish.recsResponseReceived();
      }

      setData({
        loading: false,
        units: newUnits
      });
    })();
  }, [storefrontInstance, storefrontInstanceError, mse]);
  return data;
};
// CONCATENATED MODULE: ./src/hooks/useVisibilityObserver.js
/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ~ Copyright 2021 Adobe
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~
 ~     http://www.apache.org/licenses/LICENSE-2.0
 ~
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
let cleared = {};
const useVisibilityObserver = props => {
  const {
    options = {
      threshold: [0.0, 0.5]
    }
  } = props || {};

  const callback = (entries, isVisibleCallback) => {
    entries.forEach(entry => {
      const {
        target,
        isIntersecting,
        intersectionRatio
      } = entry;

      if (!isIntersecting) {
        cleared[target] = true;
      }

      if (cleared[target] !== false && intersectionRatio >= 0.5) {
        cleared[target] = false;
        isVisibleCallback();
      }
    });
  };

  const observeElement = (element, isVisibleCallback) => {
    if (!element) {
      return;
    }

    const observer = new IntersectionObserver(entries => callback(entries, isVisibleCallback), options);
    observer.observe(element);
  };

  return {
    observeElement
  };
};
// EXTERNAL MODULE: ./src/components/ProductRecsGallery/ProductRecsGallery.css
var ProductRecsGallery = __webpack_require__(4);
var ProductRecsGallery_default = /*#__PURE__*/__webpack_require__.n(ProductRecsGallery);

// EXTERNAL MODULE: external "react-intl"
var external_react_intl_ = __webpack_require__(7);

// EXTERNAL MODULE: ./src/components/ProductRecsGallery/ProductCard.css
var ProductCard = __webpack_require__(3);
var ProductCard_default = /*#__PURE__*/__webpack_require__.n(ProductCard);

// CONCATENATED MODULE: ./src/components/ProductRecsGallery/ProductCard.js
/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ~ Copyright 2021 Adobe
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~
 ~     http://www.apache.org/licenses/LICENSE-2.0
 ~
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/







const ProductCard_ProductCard = props => {
  const {
    showAddToWishList,
    parentId
  } = props;
  const {
    mse
  } = useStorefrontInstanceContext();
  const intl = Object(external_react_intl_["useIntl"])();
  const addToCartRef = Object(external_react_["useRef"])();
  const addToWishlistRef = Object(external_react_["useRef"])();
  const [dataLayer, setDataLayer] = Object(external_react_["useState"])(undefined);
  const {
    unit: {
      unitId
    },
    product: {
      sku,
      name,
      type,
      productId,
      currency,
      prices,
      smallImage
    }
  } = props;

  const addToCart = (unit, product) => {
    const {
      sku,
      type,
      productId
    } = product;
    const {
      unitId
    } = unit;
    const customEvent = new CustomEvent('aem.cif.add-to-cart', {
      bubbles: true,
      detail: [{
        sku,
        quantity: 1,
        virtual: type === 'virtual'
      }]
    });
    addToCartRef.current.dispatchEvent(customEvent);
    mse && mse.publish.recsItemAddToCartClick(unitId, productId);
  };

  const addToWishlist = product => {
    const {
      sku
    } = product;
    const customEvent = new CustomEvent('aem.cif.add-to-wishlist', {
      bubbles: true,
      detail: [{
        sku,
        quantity: 1
      }]
    });
    addToWishlistRef.current.dispatchEvent(customEvent);
  };

  const openDetails = (unit, product) => {
    const {
      sku,
      productId
    } = product;
    const {
      unitId
    } = unit;
    window.location.assign(Object(aem_core_cif_react_components_["createProductPageUrl"])(sku));
    mse && mse.publish.recsItemClick(unitId, productId);
  };

  const renderPrice = (prices, currency) => {
    if (!prices || !prices.minimum && !prices.maximum) {
      return /*#__PURE__*/external_react_default.a.createElement(external_react_default.a.Fragment, null);
    }

    const {
      minimum,
      maximum
    } = prices;
    const isRange = Math.round(minimum.final * 100) !== Math.round(maximum.final * 100);

    if (isRange) {
      return /*#__PURE__*/external_react_default.a.createElement(external_react_default.a.Fragment, null, intl.formatMessage({
        id: "productrecs:price-from",
        defaultMessage: [{
          "type": 0,
          "value": "from"
        }]
      }), ' ', /*#__PURE__*/external_react_default.a.createElement(aem_core_cif_react_components_["Price"], {
        value: minimum.final,
        currencyCode: currency
      }));
    }

    return /*#__PURE__*/external_react_default.a.createElement(aem_core_cif_react_components_["Price"], {
      value: minimum.final,
      currencyCode: currency
    });
  };

  const renderImage = () => {
    if (!smallImage || !smallImage.url) {
      return /*#__PURE__*/external_react_default.a.createElement(external_react_default.a.Fragment, null);
    }

    return /*#__PURE__*/external_react_default.a.createElement("img", {
      className: ProductCard_default.a.productImage,
      src: smallImage.url,
      alt: name
    });
  };

  const cartProps = {
    className: ProductCard_default.a.card,
    key: sku
  };

  if (dataLayer) {
    cartProps['data-cmp-data-layer'] = JSON.stringify(dataLayer);
  }

  Object(external_react_["useEffect"])(() => {
    (async () => {
      if (parentId) {
        var _prices$minimum;

        const dataLayerKey = await aem_core_cif_react_components_["dataLayerUtils"].generateId(parentId, sku, '-item-');
        const dataLayerBody = {
          parentId,
          '@type': 'core/cif/components/commerce/productlistitem',
          'dc:title': name,
          'xdm:SKU': sku
        };

        if (prices !== null && prices !== void 0 && (_prices$minimum = prices.minimum) !== null && _prices$minimum !== void 0 && _prices$minimum.final) {
          dataLayerBody['xdm:currencyCode'] = currency;
          dataLayerBody['xdm:listPrice'] = prices.minimum.final;
        }

        const componentObject = {
          [dataLayerKey]: dataLayerBody
        }; // set the componentObject to the state

        setDataLayer(componentObject); // and add it to the datalayer

        aem_core_cif_react_components_["dataLayerUtils"].pushData({
          component: componentObject
        });
      }
    })();
  }, []);
  return /*#__PURE__*/external_react_default.a.createElement("div", cartProps, /*#__PURE__*/external_react_default.a.createElement("a", {
    href: Object(aem_core_cif_react_components_["createProductPageUrl"])(sku),
    title: name,
    onClick: () => mse && mse.publish.recsItemClick(unitId, productId)
  }, /*#__PURE__*/external_react_default.a.createElement("div", {
    className: ProductCard_default.a.cardImage
  }, renderImage()), /*#__PURE__*/external_react_default.a.createElement("div", null, name), /*#__PURE__*/external_react_default.a.createElement("div", {
    className: ProductCard_default.a.price
  }, renderPrice(prices, currency))), /*#__PURE__*/external_react_default.a.createElement(aem_core_cif_react_components_["Trigger"], {
    action: () => {
      if (['simple', 'virtual', 'downloadable'].includes(type)) {
        // Add to cart only products that can be added to cart without further customization
        addToCart(props.unit, props.product);
      } else {
        // Open details for other products
        openDetails(props.unit, props.product);
      }
    }
  }, /*#__PURE__*/external_react_default.a.createElement("span", {
    className: ProductCard_default.a.addToCart,
    ref: addToCartRef
  }, intl.formatMessage({
    id: "productrecs:add-to-cart",
    defaultMessage: [{
      "type": 0,
      "value": "Add to Cart"
    }]
  }))), showAddToWishList && /*#__PURE__*/external_react_default.a.createElement(aem_core_cif_react_components_["Trigger"], {
    className: ProductCard_default.a.buttonMargin,
    action: () => addToWishlist(props.product)
  }, /*#__PURE__*/external_react_default.a.createElement("span", {
    className: ProductCard_default.a.addToWishlist,
    ref: addToWishlistRef
  }, intl.formatMessage({
    id: "productrecs:add-to-wishlist",
    defaultMessage: [{
      "type": 0,
      "value": "Add to Wish List"
    }]
  }))));
};

ProductCard_ProductCard.propTypes = {
  unit: external_prop_types_default.a.shape({
    unitId: external_prop_types_default.a.string.isRequired
  }),
  product: external_prop_types_default.a.shape({
    sku: external_prop_types_default.a.string.isRequired,
    name: external_prop_types_default.a.string.isRequired,
    type: external_prop_types_default.a.string,
    productId: external_prop_types_default.a.number,
    currency: external_prop_types_default.a.string,
    prices: external_prop_types_default.a.shape({
      minimum: external_prop_types_default.a.shape({
        final: external_prop_types_default.a.number
      }),
      maximum: external_prop_types_default.a.shape({
        final: external_prop_types_default.a.number
      })
    }),
    smallImage: external_prop_types_default.a.shape({
      url: external_prop_types_default.a.string
    })
  }),
  showAddToWishList: external_prop_types_default.a.bool,
  parentId: external_prop_types_default.a.string
};
/* harmony default export */ var ProductRecsGallery_ProductCard = (ProductCard_ProductCard);
// CONCATENATED MODULE: ./src/components/ProductRecsGallery/ProductRecsGallery.js
/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ~ Copyright 2021 Adobe
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~
 ~     http://www.apache.org/licenses/LICENSE-2.0
 ~
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/









const ProductRecsGallery_ProductRecsGallery = props => {
  const {
    hostElement,
    cmpDataLayer
  } = props;
  const {
    mse
  } = useStorefrontInstanceContext();
  const {
    showAddToWishList
  } = props;
  const {
    loading,
    units
  } = useRecommendations(props);
  const {
    observeElement
  } = useVisibilityObserver();
  const unit = units && units.length > 0 && units[0];
  let content = '';
  Object(external_react_["useEffect"])(() => {
    if (!loading && hostElement) {
      const products = (unit === null || unit === void 0 ? void 0 : unit.products) || [];
      hostElement.dispatchEvent(new CustomEvent('aem.cif.product-recs-loaded', {
        bubbles: true,
        detail: products
      }));
    }
  }, [loading, unit]);
  Object(external_react_["useEffect"])(() => {
    if (unit) {
      mse && mse.publish.recsUnitRender(unit.unitId);
    }
  }, [mse, units]);

  if (loading) {
    content = /*#__PURE__*/external_react_default.a.createElement(aem_core_cif_react_components_["LoadingIndicator"], null);
  }

  if (units && units.length > 0 && units[0].products.length > 0) {
    let parentId;
    const unit = units[0];

    const isVisible = () => {
      mse && mse.publish.recsUnitView(unit.unitId);
    };

    if (cmpDataLayer) {
      const dataLayer = JSON.parse(cmpDataLayer);
      parentId = Object.keys(dataLayer)[0];
    }

    content = /*#__PURE__*/external_react_default.a.createElement(external_react_default.a.Fragment, null, /*#__PURE__*/external_react_default.a.createElement("h2", {
      className: ProductRecsGallery_default.a.title
    }, unit.unitName || props.title), /*#__PURE__*/external_react_default.a.createElement("div", {
      className: ProductRecsGallery_default.a.container,
      ref: e => observeElement(e, isVisible)
    }, unit.products.map(product => /*#__PURE__*/external_react_default.a.createElement(ProductRecsGallery_ProductCard, {
      parentId: parentId,
      unit: unit,
      product: product,
      key: product.sku,
      showAddToWishList: showAddToWishList
    }))));
  }

  return /*#__PURE__*/external_react_default.a.createElement("div", {
    className: ProductRecsGallery_default.a.root
  }, content);
};

ProductRecsGallery_ProductRecsGallery.propTypes = {
  title: external_prop_types_default.a.string,
  recommendationType: external_prop_types_default.a.string,
  categoryExclusions: external_prop_types_default.a.string,
  categoryInclusions: external_prop_types_default.a.string,
  excludeMaxPrice: external_prop_types_default.a.string,
  excludeMinPrice: external_prop_types_default.a.string,
  includeMaxPrice: external_prop_types_default.a.string,
  includeMinPrice: external_prop_types_default.a.string,
  preconfigured: external_prop_types_default.a.bool,
  showAddToWishList: external_prop_types_default.a.bool,
  hostElement: external_prop_types_default.a.instanceOf(HTMLElement),
  cmpDataLayer: external_prop_types_default.a.string
};
/* harmony default export */ var components_ProductRecsGallery_ProductRecsGallery = (ProductRecsGallery_ProductRecsGallery);
// CONCATENATED MODULE: ./src/components/ProductRecsGallery/index.js
/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ~ Copyright 2021 Adobe
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~
 ~     http://www.apache.org/licenses/LICENSE-2.0
 ~
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/

// CONCATENATED MODULE: ./src/index.js
/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ~ Copyright 2021 Adobe
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~
 ~     http://www.apache.org/licenses/LICENSE-2.0
 ~
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/





/***/ })
/******/ ]);
});
//# sourceMappingURL=index.js.map