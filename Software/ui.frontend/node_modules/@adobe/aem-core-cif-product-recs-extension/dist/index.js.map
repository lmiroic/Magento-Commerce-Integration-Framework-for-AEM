{"version":3,"sources":["webpack://@adobe/aem-core-cif-product-recs-extension/webpack/universalModuleDefinition","webpack://@adobe/aem-core-cif-product-recs-extension/webpack/bootstrap","webpack://@adobe/aem-core-cif-product-recs-extension/external \"react\"","webpack://@adobe/aem-core-cif-product-recs-extension/external \"prop-types\"","webpack://@adobe/aem-core-cif-product-recs-extension/external \"@adobe/aem-core-cif-react-components\"","webpack://@adobe/aem-core-cif-product-recs-extension/./src/components/ProductRecsGallery/ProductCard.css?c30d","webpack://@adobe/aem-core-cif-product-recs-extension/./src/components/ProductRecsGallery/ProductRecsGallery.css?a27a","webpack://@adobe/aem-core-cif-product-recs-extension/external \"@apollo/client\"","webpack://@adobe/aem-core-cif-product-recs-extension/external \"@magento/recommendations-js-sdk\"","webpack://@adobe/aem-core-cif-product-recs-extension/external \"react-intl\"","webpack://@adobe/aem-core-cif-product-recs-extension/./src/queries/query_storefront_instance_context.graphql.js","webpack://@adobe/aem-core-cif-product-recs-extension/./src/context/StorefrontInstanceContext.js","webpack://@adobe/aem-core-cif-product-recs-extension/./src/hooks/useRecommendations.js","webpack://@adobe/aem-core-cif-product-recs-extension/./src/hooks/useVisibilityObserver.js","webpack://@adobe/aem-core-cif-product-recs-extension/./src/components/ProductRecsGallery/ProductCard.js","webpack://@adobe/aem-core-cif-product-recs-extension/./src/components/ProductRecsGallery/ProductRecsGallery.js","webpack://@adobe/aem-core-cif-product-recs-extension/./src/components/ProductRecsGallery/index.js","webpack://@adobe/aem-core-cif-product-recs-extension/./src/index.js"],"names":["gql","STORAGE_KEY","StorefrontInstanceContext","React","createContext","StorefrontInstanceContextProvider","props","getStorefrontInstanceContext","useAwaitQuery","QUERY_STOREFRONT_INSTANCE_CONTEXT","storefrontContext","setStorefrontContext","useState","context","error","mse","undefined","useStorefrontEvents","useEffect","data","sessionStorage","getItem","JSON","parse","err","console","warn","removeItem","storefrontInstanceContext","setItem","stringify","environment","environment_id","website_id","website_code","website_name","store_url","store_id","store_code","store_name","store_view_id","store_view_code","store_view_name","catalog_extension_version","dataServicesStorefrontInstanceContext","base_currency_code","storeConfig","environmentId","storeUrl","websiteId","websiteCode","storeId","storeCode","storeViewId","storeViewCode","websiteName","storeName","storeViewName","baseCurrencyCode","storeViewCurrencyCode","catalogExtensionVersion","setStorefrontInstance","children","propTypes","PropTypes","object","useStorefrontInstanceContext","useContext","commaToOrList","list","split","join","useRecommendations","storefrontInstance","storefrontInstanceError","setData","loading","units","pageType","usePageType","title","recommendationType","categoryExclusions","categoryInclusions","excludeMaxPrice","excludeMinPrice","includeMaxPrice","includeMinPrice","preconfigured","getFilters","result","push","translateFilters","filters","length","i","replace","client","RecommendationsClient","alternateEnvironmentId","_storeViewCode","register","name","type","filter","publish","recsRequestSent","status","fetchPreconfigured","fetch","results","newUnits","getRecommendations","setRecommendations","recsResponseReceived","cleared","useVisibilityObserver","options","threshold","callback","entries","isVisibleCallback","forEach","entry","target","isIntersecting","intersectionRatio","observeElement","element","observer","IntersectionObserver","observe","ProductCard","showAddToWishList","parentId","intl","useIntl","addToCartRef","useRef","addToWishlistRef","dataLayer","setDataLayer","unit","unitId","product","sku","productId","currency","prices","smallImage","addToCart","customEvent","CustomEvent","bubbles","detail","quantity","virtual","current","dispatchEvent","recsItemAddToCartClick","addToWishlist","openDetails","window","location","assign","createProductPageUrl","recsItemClick","renderPrice","minimum","maximum","isRange","Math","round","final","formatMessage","id","defaultMessage","renderImage","url","classes","productImage","cartProps","className","card","key","dataLayerKey","dataLayerUtils","generateId","dataLayerBody","componentObject","pushData","component","cardImage","price","includes","buttonMargin","shape","string","isRequired","number","bool","ProductRecsGallery","hostElement","cmpDataLayer","content","products","recsUnitRender","isVisible","recsUnitView","Object","keys","unitName","container","e","map","root","instanceOf","HTMLElement"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;QCVA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;AClFA,kC;;;;;;ACAA,uC;;;;;;ACAA,iE;;;;;;ACAA;AACA,kBAAkB,uf;;;;;;ACDlB;AACA,kBAAkB,2L;;;;;;ACDlB,2C;;;;;;ACAA,4D;;;;;;ACAA,uC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEeA,4FAAI;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAtBA,E;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA,MAAMC,WAAW,GAAG,iCAApB;AAEO,MAAMC,yBAAyB,gBAAGC,wBAAK,CAACC,aAAN,EAAlC;AAEA,MAAMC,iCAAiC,GAAG,CAACC,KAAK,GAAG,EAAT,KAAgB;AAC7D,QAAMC,4BAA4B,GAAGC,uDAAa,CAACC,yCAAD,CAAlD;AACA,QAAM,CAACC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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@adobe/aem-core-cif-product-recs-extension\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@adobe/aem-core-cif-product-recs-extension\"] = factory();\n\telse\n\t\troot[\"@adobe/aem-core-cif-product-recs-extension\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n","module.exports = require(\"react\");","module.exports = require(\"prop-types\");","module.exports = require(\"@adobe/aem-core-cif-react-components\");","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"cmp-ProductRecsGallery__ProductCard__card\",\"cardImage\":\"cmp-ProductRecsGallery__ProductCard__cardImage\",\"productImage\":\"cmp-ProductRecsGallery__ProductCard__productImage\",\"addToCart\":\"cmp-ProductRecsGallery__ProductCard__addToCart\",\"addToWishlist\":\"cmp-ProductRecsGallery__ProductCard__addToWishlist\",\"price\":\"cmp-ProductRecsGallery__ProductCard__price\",\"regularPrice\":\"cmp-ProductRecsGallery__ProductCard__regularPrice\",\"discountedPrice\":\"cmp-ProductRecsGallery__ProductCard__discountedPrice\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"cmp-ProductRecsGallery__ProductRecsGallery__root\",\"container\":\"cmp-ProductRecsGallery__ProductRecsGallery__container\",\"title\":\"cmp-ProductRecsGallery__ProductRecsGallery__title\"};","module.exports = require(\"@apollo/client\");","module.exports = require(\"@magento/recommendations-js-sdk\");","module.exports = require(\"react-intl\");","/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n ~ Copyright 2021 Adobe\n ~\n ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n ~ you may not use this file except in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~     http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing, software\n ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n ~ See the License for the specific language governing permissions and\n ~ limitations under the License.\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/\nimport { gql } from '@apollo/client';\n\nexport default gql`\n    query DataServicesStorefrontInstanceContext {\n        dataServicesStorefrontInstanceContext {\n            catalog_extension_version\n            environment\n            environment_id\n            store_code\n            store_id\n            store_name\n            store_url\n            store_view_code\n            store_view_id\n            store_view_name\n            website_code\n            website_id\n            website_name\n        }\n        storeConfig {\n            base_currency_code\n            store_code\n        }\n    }\n`;\n","/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n ~ Copyright 2021 Adobe\n ~\n ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n ~ you may not use this file except in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~     http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing, software\n ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n ~ See the License for the specific language governing permissions and\n ~ limitations under the License.\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/\nimport React, { useContext, useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { useAwaitQuery, useStorefrontEvents } from '@adobe/aem-core-cif-react-components';\n\nimport QUERY_STOREFRONT_INSTANCE_CONTEXT from '../queries/query_storefront_instance_context.graphql';\n\nconst STORAGE_KEY = 'CIF_STOREFRONT_INSTANCE_CONTEXT';\n\nexport const StorefrontInstanceContext = React.createContext();\n\nexport const StorefrontInstanceContextProvider = (props = {}) => {\n    const getStorefrontInstanceContext = useAwaitQuery(QUERY_STOREFRONT_INSTANCE_CONTEXT);\n    const [storefrontContext, setStorefrontContext] = useState({ context: null, error: null, mse: undefined });\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const mse = typeof props.mse !== 'undefined' ? props.mse : useStorefrontEvents();\n\n    useEffect(() => {\n        (async () => {\n            // Try to read storefront context from session storage\n            let data = sessionStorage.getItem(STORAGE_KEY);\n            if (data !== null) {\n                try {\n                    data = JSON.parse(data);\n                } catch (err) {\n                    console.warn('Could not parse storefront instance context from session storage', err);\n                    sessionStorage.removeItem(STORAGE_KEY);\n                    data = null;\n                }\n            }\n\n            // Get storefront context from GraphQL if not available in session storage\n            if (data === null) {\n                let error;\n                let storefrontInstanceContext;\n                try {\n                    // We need a try/catch here, since Magento might return an invalid GraphQL response when sending\n                    // a product recs query to an instance that does not have product recs extensions installed.\n                    storefrontInstanceContext = await getStorefrontInstanceContext();\n                    error = storefrontInstanceContext.error;\n                } catch (err) {\n                    error = err;\n                }\n\n                if (error) {\n                    console.error('Could not fetch storefront instance context', error);\n                    setStorefrontContext({ context: null, error });\n                    return;\n                }\n\n                data = storefrontInstanceContext.data;\n                sessionStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n            }\n\n            const {\n                environment,\n                environment_id,\n                website_id,\n                website_code,\n                website_name,\n                store_url,\n                store_id,\n                store_code,\n                store_name,\n                store_view_id,\n                store_view_code,\n                store_view_name,\n                catalog_extension_version\n            } = data.dataServicesStorefrontInstanceContext;\n            const { base_currency_code } = data.storeConfig;\n\n            const context = {\n                environmentId: environment_id,\n                environment,\n                storeUrl: store_url,\n                websiteId: website_id,\n                websiteCode: website_code,\n                storeId: store_id,\n                storeCode: store_code,\n                storeViewId: store_view_id,\n                storeViewCode: store_view_code,\n                websiteName: website_name,\n                storeName: store_name,\n                storeViewName: store_view_name,\n                baseCurrencyCode: base_currency_code,\n                storeViewCurrencyCode: base_currency_code,\n                catalogExtensionVersion: catalog_extension_version\n            };\n\n            // Store storefront context in mse\n            mse && mse.context.setStorefrontInstance(context);\n            setStorefrontContext({ context, error: null, mse });\n        })();\n    }, [mse]);\n\n    return (\n        <StorefrontInstanceContext.Provider value={storefrontContext}>\n            {props.children}\n        </StorefrontInstanceContext.Provider>\n    );\n};\n\nStorefrontInstanceContextProvider.propTypes = {\n    mse: PropTypes.object\n};\n\nexport const useStorefrontInstanceContext = () => useContext(StorefrontInstanceContext);\n","/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n ~ Copyright 2021 Adobe\n ~\n ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n ~ you may not use this file except in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~     http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing, software\n ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n ~ See the License for the specific language governing permissions and\n ~ limitations under the License.\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/\nimport { useEffect, useState } from 'react';\n\nimport RecommendationsClient from '@magento/recommendations-js-sdk';\nimport { usePageType } from '@adobe/aem-core-cif-react-components';\n\nimport { useStorefrontInstanceContext } from '../context/StorefrontInstanceContext';\n\nconst commaToOrList = list => list.split(',').join(' OR ');\n\nexport const useRecommendations = props => {\n    const { context: storefrontInstance, error: storefrontInstanceError, mse } = useStorefrontInstanceContext();\n    const [data, setData] = useState({ loading: true, units: null });\n    const pageType = usePageType();\n\n    const {\n        title,\n        recommendationType,\n        categoryExclusions,\n        categoryInclusions,\n        excludeMaxPrice,\n        excludeMinPrice,\n        includeMaxPrice,\n        includeMinPrice,\n        preconfigured = false\n    } = props;\n\n    const getFilters = () => {\n        let result = [];\n\n        // This is currently limited to a single filter by the recommendations SDK\n        if (categoryInclusions) {\n            result.push(`categories: (${commaToOrList(categoryInclusions)})`);\n        }\n        if (categoryExclusions) {\n            result.push(`-categories: (${commaToOrList(categoryExclusions)})`);\n        }\n        if (includeMinPrice) {\n            result.push(`prices.minimum.final: >${includeMinPrice}`);\n        }\n        if (includeMaxPrice) {\n            result.push(`prices.maximum.final: <${includeMaxPrice}`);\n        }\n        if (excludeMinPrice) {\n            result.push(`prices.maximum.final: <${excludeMinPrice}`);\n        }\n        if (excludeMaxPrice) {\n            result.push(`prices.minimum.final: >${excludeMaxPrice}`);\n        }\n        return result;\n    };\n\n    const translateFilters = (filters, storeViewCode) => {\n        // Translate all filters, except for the first one. The first one is translated by the Recommendations SDK.\n        if (filters.length < 2) {\n            return filters;\n        }\n\n        for (let i = 1; i < filters.length; i++) {\n            const split = filters[i].split(':');\n            split[0] = split[0]\n                .replace('categories', `product.${storeViewCode}.categories`)\n                .replace('prices', `product.${storeViewCode}.prices`);\n\n            filters[i] = split.join(':');\n        }\n\n        return filters;\n    };\n\n    useEffect(() => {\n        // Stop loading if there is an error while retrieving the storefront instance context\n        if (storefrontInstanceError) {\n            setData({ loading: false, units: null });\n            return;\n        }\n\n        // Skip if storefront instance context is not yet available\n        if (!storefrontInstance) {\n            return;\n        }\n\n        (async () => {\n            // If no parameters are passed, everything is automatically taken from MSE\n            const client = new RecommendationsClient({ alternateEnvironmentId: '', pageType });\n\n            if (!preconfigured) {\n                // Get all configured filters, translate them, except for the first one and concatenate them with AND.\n                // This is considered a workaround and should be fixed in the Recommendations SDK.\n                let filters = getFilters();\n                filters = translateFilters(filters, client._storeViewCode);\n                filters = filters.join(' AND ');\n\n                // Register recommendation as configured in component dialog\n                client.register({ name: title, type: recommendationType, filter: filters });\n            }\n\n            mse && mse.publish.recsRequestSent();\n            const { status, data } = await (preconfigured ? client.fetchPreconfigured() : client.fetch());\n\n            if (\n                status !== 200 ||\n                !data ||\n                ((!data.units || data.units.length === 0) && (!data.results || data.results.length === 0))\n            ) {\n                setData({ loading: false, units: null });\n                return;\n            }\n\n            // Fix inconsistency in result API\n            const newUnits = preconfigured ? data.results : data.units;\n\n            if (mse) {\n                const { units = [] } = mse.context.getRecommendations() || {};\n                mse.context.setRecommendations({ units: [...units, ...newUnits] });\n                mse.publish.recsResponseReceived();\n            }\n\n            setData({ loading: false, units: newUnits });\n        })();\n    }, [storefrontInstance, storefrontInstanceError, mse]);\n\n    return data;\n};\n","/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n ~ Copyright 2021 Adobe\n ~\n ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n ~ you may not use this file except in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~     http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing, software\n ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n ~ See the License for the specific language governing permissions and\n ~ limitations under the License.\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/\nlet cleared = {};\n\nexport const useVisibilityObserver = props => {\n    const {\n        options = {\n            threshold: [0.0, 0.5]\n        }\n    } = props || {};\n\n    const callback = (entries, isVisibleCallback) => {\n        entries.forEach(entry => {\n            const { target, isIntersecting, intersectionRatio } = entry;\n\n            if (!isIntersecting) {\n                cleared[target] = true;\n            }\n\n            if (cleared[target] !== false && intersectionRatio >= 0.5) {\n                cleared[target] = false;\n                isVisibleCallback();\n            }\n        });\n    };\n\n    const observeElement = (element, isVisibleCallback) => {\n        if (!element) {\n            return;\n        }\n\n        const observer = new IntersectionObserver(entries => callback(entries, isVisibleCallback), options);\n        observer.observe(element);\n    };\n\n    return { observeElement };\n};\n","/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n ~ Copyright 2021 Adobe\n ~\n ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n ~ you may not use this file except in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~     http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing, software\n ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n ~ See the License for the specific language governing permissions and\n ~ limitations under the License.\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/\nimport React, { useEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { useIntl } from 'react-intl';\nimport { Price, Trigger, createProductPageUrl, dataLayerUtils } from '@adobe/aem-core-cif-react-components';\nimport { useStorefrontInstanceContext } from '../../context/StorefrontInstanceContext';\nimport classes from './ProductCard.css';\n\nconst ProductCard = props => {\n    const { showAddToWishList, parentId } = props;\n    const { mse } = useStorefrontInstanceContext();\n    const intl = useIntl();\n    const addToCartRef = useRef();\n    const addToWishlistRef = useRef();\n    const [dataLayer, setDataLayer] = useState(undefined);\n\n    const {\n        unit: { unitId },\n        product: { sku, name, type, productId, currency, prices, smallImage }\n    } = props;\n\n    const addToCart = (unit, product) => {\n        const { sku, type, productId } = product;\n        const { unitId } = unit;\n\n        const customEvent = new CustomEvent('aem.cif.add-to-cart', {\n            bubbles: true,\n            detail: [{ sku, quantity: 1, virtual: type === 'virtual' }]\n        });\n        addToCartRef.current.dispatchEvent(customEvent);\n\n        mse && mse.publish.recsItemAddToCartClick(unitId, productId);\n    };\n\n    const addToWishlist = product => {\n        const { sku } = product;\n\n        const customEvent = new CustomEvent('aem.cif.add-to-wishlist', {\n            bubbles: true,\n            detail: [{ sku, quantity: 1 }]\n        });\n        addToWishlistRef.current.dispatchEvent(customEvent);\n    };\n\n    const openDetails = (unit, product) => {\n        const { sku, productId } = product;\n        const { unitId } = unit;\n\n        window.location.assign(createProductPageUrl(sku));\n\n        mse && mse.publish.recsItemClick(unitId, productId);\n    };\n\n    const renderPrice = (prices, currency) => {\n        if (!prices || (!prices.minimum && !prices.maximum)) {\n            return <></>;\n        }\n\n        const { minimum, maximum } = prices;\n        const isRange = Math.round(minimum.final * 100) !== Math.round(maximum.final * 100);\n\n        if (isRange) {\n            return (\n                <>\n                    {intl.formatMessage({ id: 'productrecs:price-from', defaultMessage: 'from' })}{' '}\n                    <Price value={minimum.final} currencyCode={currency} />\n                </>\n            );\n        }\n\n        return <Price value={minimum.final} currencyCode={currency} />;\n    };\n\n    const renderImage = () => {\n        if (!smallImage || !smallImage.url) {\n            return <></>;\n        }\n        return <img className={classes.productImage} src={smallImage.url} alt={name} />;\n    };\n\n    const cartProps = {\n        className: classes.card,\n        key: sku\n    };\n\n    if (dataLayer) {\n        cartProps['data-cmp-data-layer'] = JSON.stringify(dataLayer);\n    }\n\n    useEffect(() => {\n        (async () => {\n            if (parentId) {\n                const dataLayerKey = await dataLayerUtils.generateId(parentId, sku, '-item-');\n                const dataLayerBody = {\n                    parentId,\n                    '@type': 'core/cif/components/commerce/productlistitem',\n                    'dc:title': name,\n                    'xdm:SKU': sku\n                };\n\n                if (prices?.minimum?.final) {\n                    dataLayerBody['xdm:currencyCode'] = currency;\n                    dataLayerBody['xdm:listPrice'] = prices.minimum.final;\n                }\n\n                const componentObject = { [dataLayerKey]: dataLayerBody };\n                // set the componentObject to the state\n                setDataLayer(componentObject);\n                // and add it to the datalayer\n                dataLayerUtils.pushData({\n                    component: componentObject\n                });\n            }\n        })();\n    }, []);\n\n    return (\n        <div {...cartProps}>\n            <a\n                href={createProductPageUrl(sku)}\n                title={name}\n                onClick={() => mse && mse.publish.recsItemClick(unitId, productId)}>\n                <div className={classes.cardImage}>{renderImage()}</div>\n                <div>{name}</div>\n                <div className={classes.price}>{renderPrice(prices, currency)}</div>\n            </a>\n            {\n                <Trigger\n                    action={() => {\n                        if (['simple', 'virtual', 'downloadable'].includes(type)) {\n                            // Add to cart only products that can be added to cart without further customization\n                            addToCart(props.unit, props.product);\n                        } else {\n                            // Open details for other products\n                            openDetails(props.unit, props.product);\n                        }\n                    }}>\n                    <span className={classes.addToCart} ref={addToCartRef}>\n                        {intl.formatMessage({ id: 'productrecs:add-to-cart', defaultMessage: 'Add to Cart' })}\n                    </span>\n                </Trigger>\n            }\n            {showAddToWishList && (\n                <Trigger className={classes.buttonMargin} action={() => addToWishlist(props.product)}>\n                    <span className={classes.addToWishlist} ref={addToWishlistRef}>\n                        {intl.formatMessage({ id: 'productrecs:add-to-wishlist', defaultMessage: 'Add to Wish List' })}\n                    </span>\n                </Trigger>\n            )}\n        </div>\n    );\n};\n\nProductCard.propTypes = {\n    unit: PropTypes.shape({\n        unitId: PropTypes.string.isRequired\n    }),\n    product: PropTypes.shape({\n        sku: PropTypes.string.isRequired,\n        name: PropTypes.string.isRequired,\n        type: PropTypes.string,\n        productId: PropTypes.number,\n        currency: PropTypes.string,\n        prices: PropTypes.shape({\n            minimum: PropTypes.shape({\n                final: PropTypes.number\n            }),\n            maximum: PropTypes.shape({\n                final: PropTypes.number\n            })\n        }),\n        smallImage: PropTypes.shape({\n            url: PropTypes.string\n        })\n    }),\n    showAddToWishList: PropTypes.bool,\n    parentId: PropTypes.string\n};\n\nexport default ProductCard;\n","/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n ~ Copyright 2021 Adobe\n ~\n ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n ~ you may not use this file except in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~     http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing, software\n ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n ~ See the License for the specific language governing permissions and\n ~ limitations under the License.\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/\nimport React, { useEffect } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { LoadingIndicator } from '@adobe/aem-core-cif-react-components';\n\nimport { useStorefrontInstanceContext } from '../../context/StorefrontInstanceContext';\nimport { useRecommendations } from '../../hooks/useRecommendations';\nimport { useVisibilityObserver } from '../../hooks/useVisibilityObserver';\n\nimport classes from './ProductRecsGallery.css';\nimport ProductCard from './ProductCard';\n\nconst ProductRecsGallery = props => {\n    const { hostElement, cmpDataLayer } = props;\n    const { mse } = useStorefrontInstanceContext();\n    const { showAddToWishList } = props;\n    const { loading, units } = useRecommendations(props);\n    const { observeElement } = useVisibilityObserver();\n    const unit = units && units.length > 0 && units[0];\n\n    let content = '';\n\n    useEffect(() => {\n        if (!loading && hostElement) {\n            const products = unit?.products || [];\n            hostElement.dispatchEvent(\n                new CustomEvent('aem.cif.product-recs-loaded', {\n                    bubbles: true,\n                    detail: products\n                })\n            );\n        }\n    }, [loading, unit]);\n\n    useEffect(() => {\n        if (unit) {\n            mse && mse.publish.recsUnitRender(unit.unitId);\n        }\n    }, [mse, units]);\n\n    if (loading) {\n        content = <LoadingIndicator />;\n    }\n\n    if (units && units.length > 0 && units[0].products.length > 0) {\n        let parentId;\n        const unit = units[0];\n\n        const isVisible = () => {\n            mse && mse.publish.recsUnitView(unit.unitId);\n        };\n\n        if (cmpDataLayer) {\n            const dataLayer = JSON.parse(cmpDataLayer);\n            parentId = Object.keys(dataLayer)[0];\n        }\n\n        content = (\n            <>\n                <h2 className={classes.title}>{unit.unitName || props.title}</h2>\n                <div className={classes.container} ref={e => observeElement(e, isVisible)}>\n                    {unit.products.map(product => (\n                        <ProductCard\n                            parentId={parentId}\n                            unit={unit}\n                            product={product}\n                            key={product.sku}\n                            showAddToWishList={showAddToWishList}\n                        />\n                    ))}\n                </div>\n            </>\n        );\n    }\n\n    return <div className={classes.root}>{content}</div>;\n};\n\nProductRecsGallery.propTypes = {\n    title: PropTypes.string,\n    recommendationType: PropTypes.string,\n    categoryExclusions: PropTypes.string,\n    categoryInclusions: PropTypes.string,\n    excludeMaxPrice: PropTypes.string,\n    excludeMinPrice: PropTypes.string,\n    includeMaxPrice: PropTypes.string,\n    includeMinPrice: PropTypes.string,\n    preconfigured: PropTypes.bool,\n    showAddToWishList: PropTypes.bool,\n    hostElement: PropTypes.instanceOf(HTMLElement),\n    cmpDataLayer: PropTypes.string\n};\n\nexport default ProductRecsGallery;\n","/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n ~ Copyright 2021 Adobe\n ~\n ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n ~ you may not use this file except in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~     http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing, software\n ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n ~ See the License for the specific language governing permissions and\n ~ limitations under the License.\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/\nexport { default } from './ProductRecsGallery';\n","/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n ~ Copyright 2021 Adobe\n ~\n ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n ~ you may not use this file except in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~     http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing, software\n ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n ~ See the License for the specific language governing permissions and\n ~ limitations under the License.\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/\nexport { default as ProductRecsGallery } from './components/ProductRecsGallery';\nexport { StorefrontInstanceContextProvider, useStorefrontInstanceContext } from './context/StorefrontInstanceContext';\nexport { useRecommendations } from './hooks/useRecommendations';\nexport { useVisibilityObserver } from './hooks/useVisibilityObserver';\n"],"sourceRoot":""}